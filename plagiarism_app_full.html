<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Антиплагиат Pro - Material You</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --md-primary: #6750A4;
            --md-primary-container: #EADDFF;
            --md-secondary: #625B71;
            --md-secondary-container: #E8DEF8;
            --md-tertiary: #7D5260;
            --md-surface: #FFFBFE;
            --md-surface-variant: #E7E0EC;
            --md-background: #FFFBFE;
            --md-error: #BA1A1A;
            --md-success: #2E7D32;
            --md-warning: #F57C00;
            --md-on-primary: #FFFFFF;
            --md-on-surface: #1C1B1F;
            --md-outline: #79747E;
            --md-shadow: rgba(0,0,0,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* LOGIN PAGE */
        .login-page {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: var(--md-surface);
            border-radius: 28px;
            padding: 48px;
            max-width: 480px;
            width: 100%;
            box-shadow: 0 8px 32px var(--md-shadow);
            animation: fadeInUp 0.6s ease-out;
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-icon {
            font-size: 64px;
            animation: float 3s ease-in-out infinite;
            margin-bottom: 16px;
        }

        .login-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--md-on-surface);
            margin-bottom: 8px;
        }

        .login-subtitle {
            font-size: 16px;
            color: var(--md-outline);
        }

        .md-button {
            background: var(--md-primary);
            color: var(--md-on-primary);
            border: none;
            border-radius: 100px;
            padding: 16px 32px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            box-shadow: 0 2px 8px rgba(103, 80, 164, 0.3);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .md-button:hover {
            box-shadow: 0 4px 16px rgba(103, 80, 164, 0.4);
            transform: translateY(-2px);
        }

        .md-button:active {
            transform: translateY(0);
        }

        .md-button-secondary {
            background: var(--md-secondary);
        }

        .md-button-outline {
            background: transparent;
            border: 2px solid var(--md-primary);
            color: var(--md-primary);
        }

        .md-select {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--md-outline);
            border-radius: 12px;
            font-size: 16px;
            color: var(--md-on-surface);
            background: var(--md-surface);
            margin-bottom: 24px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .md-select:focus {
            outline: none;
            border-color: var(--md-primary);
            box-shadow: 0 0 0 4px rgba(103, 80, 164, 0.1);
        }

        /* MAIN PAGE */
        .main-page {
            display: none;
            animation: fadeInUp 0.6s ease-out;
        }

        .main-page.active {
            display: block;
        }

        /* NAVBAR */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 16px 24px;
            margin: 20px;
            box-shadow: 0 8px 32px var(--md-shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 700;
            color: var(--md-primary);
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-chip {
            background: var(--md-primary-container);
            color: var(--md-primary);
            padding: 8px 16px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .logout-btn {
            background: transparent;
            border: 2px solid var(--md-error);
            color: var(--md-error);
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .logout-btn:hover {
            background: var(--md-error);
            color: white;
        }

        /* LAYOUT */
        .content {
            margin: 20px;
        }

        .layout {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 8px 32px var(--md-shadow);
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 8px;
            color: var(--md-on-surface);
            font-weight: 500;
        }

        .menu-item:hover {
            background: var(--md-secondary-container);
            transform: translateX(4px);
        }

        .menu-item.active {
            background: var(--md-primary-container);
            color: var(--md-primary);
        }

        /* CARD */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 32px;
            box-shadow: 0 8px 32px var(--md-shadow);
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px var(--md-shadow);
        }

        .card-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--md-on-surface);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* METRICS */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .metric-card {
            background: linear-gradient(135deg, var(--md-primary) 0%, var(--md-secondary) 100%);
            border-radius: 20px;
            padding: 24px;
            color: white;
            box-shadow: 0 8px 24px rgba(103, 80, 164, 0.3);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            transition: all 0.6s;
        }

        .metric-card:hover {
            transform: translateY(-4px) scale(1.02);
            animation: pulse 2s infinite;
        }

        .metric-card:hover::before {
            top: -100%;
            right: -100%;
        }

        .metric-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 4px;
            position: relative;
            z-index: 1;
        }

        .metric-label {
            font-size: 14px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        /* INPUT */
        .md-input {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--md-outline);
            border-radius: 12px;
            font-size: 16px;
            font-family: 'Roboto', sans-serif;
            transition: all 0.3s;
            background: var(--md-surface);
            margin-bottom: 16px;
        }

        .md-input:focus {
            outline: none;
            border-color: var(--md-primary);
            box-shadow: 0 0 0 4px rgba(103, 80, 164, 0.1);
        }

        .md-textarea {
            min-height: 150px;
            resize: vertical;
        }

        /* RESULT CARD */
        .result-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 32px;
            color: white;
            margin-top: 24px;
            animation: fadeInUp 0.6s ease-out;
        }

        .similarity-circle {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            font-size: 48px;
            font-weight: 700;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            position: relative;
        }

        .similarity-circle::after {
            content: '';
            position: absolute;
            inset: -10px;
            border-radius: 50%;
            padding: 10px;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeInUp 0.6s ease-out;
        }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-admin {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .badge-user {
            background: var(--md-secondary-container);
            color: var(--md-secondary);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--md-surface-variant);
            border-radius: 4px;
            overflow: hidden;
            margin: 16px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--md-primary), var(--md-secondary));
            border-radius: 4px;
            transition: width 0.6s ease-out;
        }

        .info-box {
            margin-top: 24px;
            padding: 16px;
            background: var(--md-primary-container);
            border-radius: 12px;
            font-size: 14px;
            border-left: 4px solid var(--md-primary);
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 14px;
        }

        .status-success {
            background: #E8F5E9;
            color: var(--md-success);
        }

        .status-warning {
            background: #FFF3E0;
            color: var(--md-warning);
        }

        .status-error {
            background: #FFEBEE;
            color: var(--md-error);
        }

        .doc-item {
            background: var(--md-surface-variant);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 12px;
            transition: all 0.3s;
            border-left: 4px solid var(--md-primary);
        }

        .doc-item:hover {
            transform: translateX(8px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .doc-title {
            font-weight: 600;
            font-size: 18px;
            color: var(--md-on-surface);
            margin-bottom: 8px;
        }

        .doc-meta {
            font-size: 14px;
            color: var(--md-outline);
            margin-bottom: 12px;
        }

        .doc-text {
            font-size: 15px;
            line-height: 1.6;
            color: var(--md-on-surface);
        }

        .filter-section {
            background: var(--md-surface-variant);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .stat-item {
            background: var(--md-surface-variant);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--md-primary);
        }

        .stat-label {
            font-size: 14px;
            color: var(--md-outline);
            margin-top: 4px;
        }

        .code-block {
            background: #1E1E1E;
            color: #D4D4D4;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 16px 0;
        }

        .tab-container {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--md-outline);
        }

        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: var(--md-outline);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab:hover {
            color: var(--md-primary);
        }

        .tab.active {
            color: var(--md-primary);
            border-bottom-color: var(--md-primary);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 968px) {
            .layout {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
                display: flex;
                overflow-x: auto;
                padding: 16px;
            }
            
            .menu-item {
                flex-shrink: 0;
            }

            .navbar {
                flex-direction: column;
                gap: 16px;
            }
        }

        .chart-container {
            background: var(--md-surface);
            padding: 20px;
            border-radius: 16px;
            margin-top: 20px;
        }

        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .tooltip.show {
            opacity: 1;
        }
    </style>
</head>
<body>

    <!-- LOGIN PAGE -->
    <div class="login-page" id="loginPage">
        <div class="login-card">
            <div class="login-header">
                <div class="login-icon">🔍</div>
                <h1 class="login-title">Антиплагиат Pro</h1>
                <p class="login-subtitle">Система проверки оригинальности текстов</p>
            </div>

            <select class="md-select" id="userSelect">
                <option value="">Выберите пользователя...</option>
            </select>

            <button class="md-button" onclick="login()">
                <span class="material-icons">login</span>
                Войти в систему
            </button>

            <div class="info-box">
                <p style="margin-bottom: 8px;"><strong>💡 Подсказка:</strong></p>
                <p>👑 <strong>Администратор</strong> - полный доступ</p>
                <p>👤 <strong>Пользователь</strong> - проверка текстов</p>
            </div>
        </div>
    </div>

    <!-- MAIN PAGE -->
    <div class="main-page" id="mainPage">
        <nav class="navbar">
            <div class="nav-brand">
                <span class="material-icons">search</span>
                <span>Антиплагиат Pro</span>
            </div>
            <div class="nav-user">
                <div class="user-chip">
                    <span class="material-icons">account_circle</span>
                    <span id="userName"></span>
                    <span class="badge" id="userRole"></span>
                </div>
                <button class="logout-btn" onclick="logout()">
                    <span class="material-icons">logout</span>
                    Выйти
                </button>
            </div>
        </nav>

        <div class="content">
            <div class="layout">
                <aside class="sidebar">
                    <div class="menu-item active" onclick="showSection('overview')">
                        <span class="material-icons">dashboard</span>
                        <span>Обзор</span>
                    </div>
                    <div class="menu-item" onclick="showSection('check')">
                        <span class="material-icons">spellcheck</span>
                        <span>Проверить</span>
                    </div>
                    <div class="menu-item" onclick="showSection('data')">
                        <span class="material-icons">folder</span>
                        <span>Данные</span>
                    </div>
                    <div class="menu-item" onclick="showSection('functions')">
                        <span class="material-icons">functions</span>
                        <span>Функции</span>
                    </div>
                    <div class="menu-item" onclick="showSection('pipelines')">
                        <span class="material-icons">account_tree</span>
                        <span>Пайплайны</span>
                    </div>
                    <div class="menu-item" onclick="showSection('memo')">
                        <span class="material-icons">memory</span>
                        <span>Мемоизация</span>
                    </div>
                    <div class="menu-item" onclick="showSection('reports')">
                        <span class="material-icons">assessment</span>
                        <span>Отчёты</span>
                    </div>
                    <div class="menu-item" onclick="showSection('tests')">
                        <span class="material-icons">fact_check</span>
                        <span>Тесты</span>
                    </div>
                    <div class="menu-item" onclick="showSection('about')">
                        <span class="material-icons">info</span>
                        <span>О проекте</span>
                    </div>
                </aside>

                <main>
                    <!-- OVERVIEW -->
                    <section id="overview" class="section active">
                        <div class="card">
                            <h2 class="card-title">
                                <span class="material-icons">dashboard</span>
                                Обзор системы
                            </h2>
                        </div>
                        <div class="metrics-grid" id="metricsGrid"></div>
                        <div class="card">
                            <h3 class="card-title">
                                <span class="material-icons">trending_up</span>
                                Статистика
                            </h3>
                            <div id="statisticsContent"></div>
                        </div>
                    </section>

                    <!-- CHECK -->
                    <section id="check" class="section">
                        <div class="card">
                            <h2 class="card-title">
                                <span class="material-icons">spellcheck</span>
                                Проверить текст на плагиат
                            </h2>
                            <textarea 
                                class="md-input md-textarea" 
                                id="checkText"
                                placeholder="Введите или вставьте текст для проверки..."></textarea>
                            
                            <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                                <label style="flex: 1;">
                                    <span style="display: block; margin-bottom: 8px; font-weight: 500;">Размер n-грамм:</span>
                                    <input type="number" class="md-input" id="ngramSize" value="3" min="1" max="5" style="margin: 0;">
                                </label>
                                <label style="flex: 1;">
                                    <span style="display: block; margin-bottom: 8px; font-weight: 500;">Использовать кэш:</span>
                                    <select class="md-select" id="useCache" style="margin: 0;">
                                        <option value="true">Да (быстрее)</option>
                                        <option value="false">Нет</option>
                                    </select>
                                </label>
                            </div>
                            
                            <button class="md-button" onclick="checkPlagiarism()">
                                <span class="material-icons">search</span>
                                Проверить на плагиат
                            </button>
                            <div id="checkResult"></div>
                        </div>
                    </section>

                    <!-- DATA -->
                    <section id="data" class="section">
                        <div class="card">
                            <h2 class="card-title">
                                <span class="material-icons">folder</span>
                                База документов
                            </h2>
                            
                            <div class="filter-section">
                                <h3 style="margin-bottom: 12px;">🔍 Фильтры (Лаба №2)</h3>
                                <div class="filter-row">
                                    <input type="text" class="md-input" id="filterAuthor" placeholder="Автор..." style="margin: 0;">
                                    <input type="text" class="md-input" id="filterTitle" placeholder="Название..." style="margin: 0;">
                                    <input type="number" class="md-input" id="filterMinLength" placeholder="Мин. длина..." style="margin: 0;">
                                </div>
                                <button class="md-button" onclick="applyFilters()" style="margin-top: 16px;">
                                    <span class="material-icons">filter_alt</span>
                                    Применить фильтры
                                </button>
                            </div>
                            
                            <div id="documentsTable"></div>
                        </div>
                    </section>

                    <!-- FUNCTIONS -->
                    <section id="functions" class="section">
                        <div class="card">
                            <h2 class="card-title">
                                <span class="material-icons">functions</span>
                                Демонстрация функций (Лаба №1)
                            </h2>
                            <p style="margin-bottom: 20px; color: var(--md-outline);">
                                Тестирование функций обработки текста: normalize, tokenize, ngrams, jaccard
                            </p>
                            <textarea 
                                class="md-input md-textarea" 
                                id="demoText"
                                placeholder="Введите текст...">Привет, Мир! Это тестовый текст для демонстрации функций.</textarea>
                            <button class="md-button" onclick="demonstrateFunctions()">
                                <span class="material-icons">play_arrow</span>
                                Запустить демонстрацию
                            </button>
                            <div id="functionResults"></div>
                        </div>
                    </section>

                    <!-- PIPELINES -->
                    <section id="pipelines" class="section">
                        <div class="card">
                            <h2 class="card-title">
                                <span class="material-icons">account_tree</span>
                                Пайплайны и композиция (Лаба №4)
                            </h2>
                            
                            <div class="tab-container">
                                <button class="tab active" onclick="showPipelineTab('compose')">Композиция</button>
                                <button class="tab" onclick="showPipelineTab('maybe')">Maybe/Either</button>
                                <button class="tab" onclick="showPipelineTab('validation')">Валидация</button>
                            </div>

                            <div id="pipelineCompose" class="pipeline-tab active">
                                <h3>Композиция функций</h3>
                                <textarea class="md-input md-textarea" id="pipelineText" placeholder="Текст для обработки...">Привет, МИР!!! Это ТЕСТ композиции функций.</textarea>
                                <button class="md-button" onclick="demonstrateComposition()">
                                    <span class="material-icons">layers</span>
                                    Применить пайплайн
                                </button>
                                <div id="compositionResult"></div>
                            </div>

                            <div id="pipelineMaybe" class="pipeline-tab" style="display: none;">
                                <h3>Maybe/Either типы</h3>
                                <p style="color: var(--md-outline); margin-bottom: 16px;">
                                    Безопасная обработка ошибок без исключений
                                </p>
                                <input type="text" class="md-input" id="docId" placeholder="ID документа (например: doc_001)">
                                <button class="md-button" onclick="demonstrateMaybe()">
                                    <span class="material-icons">done</span>
                                    Найти документ (Maybe)
                                </button>
                                <div id="maybeResult"></div>
                            </div>

                            <div id="pipelineValidation" class="pipeline-tab" style="display: none;">
                                <h3>Валидация с Either</h3>
                                <textarea class="md-input md-textarea" id="validationText" placeholder="Текст для валидации..."></textarea>
                                <input type="number" class="md-input" id="minLengthValidation" placeholder="Минимальная длина" value="50">
                                <button class="md-button" onclick="demonstrateValidation()">
                                    <span class="material-icons">verified</span>
                                    Валидировать
                                </button>
                                <div id="validationResult"></div>
                            </div>
                        </div>
                    </section>

                    <!-- MEMOIZATION -->
                    <section id="memo" class="section">
                        <div class="card">
                            <h2 class="card-title">
                                <span class="material-icons">memory</span>
                                Мемоизация и кэширование (Лаба №3)
                            </h2>
                            <p style="color: var(--md-outline); margin-bottom: 20px;">
                                Сравнение производительности с кэшем и без кэша
                            </p>
                            
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-value" id="cacheHits">0</div>
                                    <div class="stat-label">Попадания в кэш</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="cacheMisses">0</div>
                                    <div class="stat-label">Промахи кэша</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="cacheSize">0</div>
                                    <div class="stat-label">Размер кэша</div>
                                </div>
                            </div>

                            <button class="md-button" onclick="runBenchmark()" style="margin-top: 20px;">
                                <span class="material-icons">speed</span>
                                Запустить бенчмарк
                            </button>
                            
                            <div id="benchmarkResult"></div>
                        </div>
                    </section>

                    <!-- REPORTS -->
                    <section id="reports" class="section">
                        <div class="card">
                            <h2 class="card-title">
                                <span class="material-icons">assessment</span>
                                Отчёты и аналитика
                            </h2>
                            
                            <div class="tab-container">
                                <button class="tab active" onclick="showReportTab('summary')">Сводка</button>
                                <button class="tab" onclick="showReportTab('top')">Топ проблемных</button>
                                <button class="tab" onclick="showReportTab('users')">По пользователям</button>
                            </div>

                            <div id="reportSummary" class="report-tab active">
                                <div id="summaryContent"></div>
                            </div>

                            <div id="reportTop" class="report-tab" style="display: none;">
                                <div id="topContent"></div>
                            </div>

                            <div id="reportUsers" class="report-tab" style="display: none;">
                                <div id="usersContent"></div>
                            </div>

                            <button class="md-button" onclick="generateReport()">
                                <span class="material-icons">description</span>
                                Сгенерировать отчёт
                            </button>
                        </div>
                    </section>

                    <!-- TESTS -->
                    <section id="tests" class="section">
                        <div class="card">
                            <h2 class="card-title">
                                <span class="material-icons">fact_check</span>
                                Автоматические тесты
                            </h2>
                            <p style="color: var(--md-outline); margin-bottom: 20px;">
                                Запуск всех unit-тестов для проверки функциональности
                            </p>
                            
                            <button class="md-button" onclick="runAllTests()">
                                <span class="material-icons">play_circle</span>
                                Запустить все тесты
                            </button>
                            
                            <div id="testResults"></div>
                        </div>
                    </section>

                    <!-- ABOUT -->
                    <section id="about" class="section">
                        <div class="card">
                            <h2 class="card-title">
                                <span class="material-icons">info</span>
                                О проекте
                            </h2>
                            <p style="font-size: 16px; line-height: 1.6; margin-bottom: 16px;">
                                <strong>Антиплагиат Pro</strong> - система проверки текстов на оригинальность в функциональном стиле.
                            </p>
                            
                            <h3 style="margin: 24px 0 12px;">🎯 Возможности:</h3>
                            <div style="display: grid; gap: 12px;">
                                <div class="info-box">
                                    <strong>✅ Лаба №1:</strong> Чистые функции + неизменяемость + HOF (map/filter/reduce)
                                </div>
                                <div class="info-box">
                                    <strong>✅ Лаба №2:</strong> Лямбда и замыкания + рекурсия
                                </div>
                                <div class="info-box">
                                    <strong>✅ Лаба №3:</strong> Продвинутая рекурсия + мемоизация
                                </div>
                                <div class="info-box">
                                    <strong>✅ Лаба №4:</strong> Maybe/Either типы + композиция
                                </div>
                            </div>

                            <h3 style="margin: 24px 0 12px;">🛠 Технологии:</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 8px 0;">📦 Python 3.11+</li>
                                <li style="padding: 8px 0;">🎨 Material You Design</li>
                                <li style="padding: 8px 0;">⚡ Функциональное программирование</li>
                                <li style="padding: 8px 0;">🧪 Pytest для тестирования</li>
                                <li style="padding: 8px 0;">💾 JSON для данных</li>
                            </ul>

                            <h3 style="margin: 24px 0 12px;">📊 Архитектура:</h3>
                            <div class="code-block">
core/
  domain.py      # Иммутабельные модели
  transforms.py  # Чистые функции
  closures.py    # Замыкания и фильтры
  memo.py        # Мемоизация
  ftypes.py      # Maybe/Either
  compose.py     # Композиция
                            </div>
                        </div>
                    </section>
                </main>
            </div>
        </div>
    </div>

    <script>
        let appData = {
            documents: [],
            users: [],
            submissions: [],
            rules: []
        };

        let currentUser = null;
        let cache = new Map();
        let cacheStats = { hits: 0, misses: 0 };

        // ============ ЗАГРУЗКА ДАННЫХ ============
        async function loadData() {
            try {
                const response = await fetch('data/seed.json');
                const data = await response.json();
                
                appData.documents = data.documents || [];
                appData.users = (data.users || []).map((u, i) => ({
                    ...u,
                    role: u.role || (i < 3 ? 'admin' : 'user')
                }));
                appData.submissions = data.submissions || [];
                appData.rules = data.rules || [];
                
                populateUserSelect();
            } catch (error) {
                console.error('Ошибка загрузки:', error);
                alert('Не удалось загрузить данные. Проверьте файл data/seed.json');
            }
        }

        function populateUserSelect() {
            const select = document.getElementById('userSelect');
            appData.users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = `${user.name} (${user.role === 'admin' ? '👑 Админ' : '👤 Пользователь'})`;
                select.appendChild(option);
            });
        }

        // ============ AUTHENTICATION ============
        function login() {
            const select = document.getElementById('userSelect');
            const userId = select.value;
            
            if (!userId) {
                alert('Пожалуйста, выберите пользователя');
                return;
            }
            
            currentUser = appData.users.find(u => u.id === userId);
            
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainPage').classList.add('active');
            
            document.getElementById('userName').textContent = currentUser.name;
            const roleBadge = document.getElementById('userRole');
            roleBadge.textContent = currentUser.role === 'admin' ? '👑 Админ' : '👤 Пользователь';
            roleBadge.className = `badge ${currentUser.role === 'admin' ? 'badge-admin' : 'badge-user'}`;
            
            renderOverview();
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('mainPage').classList.remove('active');
            document.getElementById('userSelect').value = '';
        }

        // ============ NAVIGATION ============
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            event.target.closest('.menu-item').classList.add('active');
            
            if (sectionId === 'overview') renderOverview();
            if (sectionId === 'data') renderData();
            if (sectionId === 'reports') generateReport();
        }

        function showPipelineTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.pipeline-tab').forEach(t => t.style.display = 'none');
            document.getElementById('pipeline' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).style.display = 'block';
        }

        function showReportTab(tabName) {
            document.querySelectorAll('#reports .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.report-tab').forEach(t => t.style.display = 'none');
            document.getElementById('report' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).style.display = 'block';
        }

        // ============ CORE FUNCTIONS (ЛАБА №1) ============
        function normalize(text) {
            return text.toLowerCase().replace(/[^\wа-яё\s]/gi, '').replace(/\s+/g, ' ').trim();
        }
        
        function tokenize(text) {
            return text.split(' ').filter(w => w.length > 0);
        }
        
        function ngrams(tokens, n = 3) {
            const result = [];
            for (let i = 0; i <= tokens.length - n; i++) {
                result.push(tokens.slice(i, i + n).join(' '));
            }
            return result;
        }
        
        function jaccard(set1, set2) {
            const s1 = new Set(set1);
            const s2 = new Set(set2);
            const intersection = new Set([...s1].filter(x => s2.has(x)));
            const union = new Set([...s1, ...s2]);
            return union.size > 0 ? intersection.size / union.size : 0;
        }

        // ============ CLOSURES (ЛАБА №2) ============
        function byAuthor(author) {
            return (doc) => doc.author.toLowerCase().includes(author.toLowerCase());
        }

        function byTitle(keyword) {
            return (doc) => doc.title.toLowerCase().includes(keyword.toLowerCase());
        }

        function byMinLength(minLen) {
            return (doc) => doc.text.length >= minLen;
        }

        function composeFilters(...filters) {
            return (item) => filters.every(f => f(item));
        }

        // ============ MEMOIZATION (ЛАБА №3) ============
        function getCacheKey(text1, text2, n) {
            return `${text1.substring(0, 50)}_${text2.substring(0, 50)}_${n}`;
        }

        function compareTextsCached(text1, text2, n = 3) {
            const key = getCacheKey(text1, text2, n);
            
            if (cache.has(key)) {
                cacheStats.hits++;
                updateCacheStats();
                return cache.get(key);
            }
            
            cacheStats.misses++;
            const normalized1 = normalize(text1);
            const normalized2 = normalize(text2);
            const tokens1 = tokenize(normalized1);
            const tokens2 = tokenize(normalized2);
            const ngrams1 = ngrams(tokens1, n);
            const ngrams2 = ngrams(tokens2, n);
            const similarity = jaccard(ngrams1, ngrams2);
            
            cache.set(key, similarity);
            updateCacheStats();
            return similarity;
        }

        function updateCacheStats() {
            document.getElementById('cacheHits').textContent = cacheStats.hits;
            document.getElementById('cacheMisses').textContent = cacheStats.misses;
            document.getElementById('cacheSize').textContent = cache.size;
        }

        // ============ MAYBE/EITHER (ЛАБА №4) ============
        class Maybe {
            constructor(value, isNothing = false) {
                this._value = value;
                this._isNothing = isNothing;
            }
            
            static just(value) {
                return new Maybe(value, false);
            }
            
            static nothing() {
                return new Maybe(null, true);
            }
            
            isNothing() {
                return this._isNothing;
            }
            
            isJust() {
                return !this._isNothing;
            }
            
            get(defaultValue = null) {
                return this._isNothing ? defaultValue : this._value;
            }
            
            map(fn) {
                if (this._isNothing) return Maybe.nothing();
                try {
                    return Maybe.just(fn(this._value));
                } catch {
                    return Maybe.nothing();
                }
            }
        }

        class Either {
            constructor(value, isLeft) {
                this._value = value;
                this._isLeft = isLeft;
            }
            
            static left(error) {
                return new Either(error, true);
            }
            
            static right(value) {
                return new Either(value, false);
            }
            
            isLeft() {
                return this._isLeft;
            }
            
            isRight() {
                return !this._isLeft;
            }
            
            getRight(defaultValue = null) {
                return this._isLeft ? defaultValue : this._value;
            }
            
            getLeft(defaultValue = null) {
                return this._isLeft ? this._value : defaultValue;
            }
            
            map(fn) {
                if (this._isLeft) return Either.left(this._value);
                try {
                    return Either.right(fn(this._value));
                } catch (e) {
                    return Either.left(e.message);
                }
            }
        }

        function safeGetDocument(docs, docId) {
            const doc = docs.find(d => d.id === docId);
            return doc ? Maybe.just(doc) : Maybe.nothing();
        }

        function validateSubmission(text, minLength = 50) {
            if (!text || text.trim().length === 0) {
                return Either.left("Текст не может быть пустым");
            }
            if (text.length < minLength) {
                return Either.left(`Текст слишком короткий (минимум ${minLength} символов)`);
            }
            return Either.right(text);
        }

        // ============ UI RENDERS ============
        function renderOverview() {
            const metricsHTML = `
                <div class="metric-card">
                    <div class="metric-value">${appData.documents.length}</div>
                    <div class="metric-label">Документов в базе</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${appData.users.length}</div>
                    <div class="metric-label">Пользователей</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${appData.submissions.length}</div>
                    <div class="metric-label">Проверок</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${appData.rules.length}</div>
                    <div class="metric-label">Правил</div>
                </div>
            `;
            document.getElementById('metricsGrid').innerHTML = metricsHTML;
            
            const avgDoc = appData.documents.length > 0
                ? Math.round(appData.documents.reduce((sum, d) => sum + d.text.length, 0) / appData.documents.length)
                : 0;
            
            const avgSub = appData.submissions.length > 0
                ? Math.round(appData.submissions.reduce((sum, s) => sum + s.text.length, 0) / appData.submissions.length)
                : 0;
            
            document.getElementById('statisticsContent').innerHTML = `
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value">${avgDoc}</div>
                        <div class="stat-label">Средняя длина документа</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${avgSub}</div>
                        <div class="stat-label">Средняя длина проверки</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${cache.size}</div>
                        <div class="stat-label">Записей в кэше</div>
                    </div>
                </div>
            `;
        }

        function renderData(filteredDocs = null) {
            const docs = filteredDocs || appData.documents;
            const docsHTML = docs.slice(0, 10).map(doc => `
                <div class="doc-item">
                    <div class="doc-title">${doc.title}</div>
                    <div class="doc-meta">
                        <span>👤 ${doc.author}</span> • 
                        <span>📅 ${new Date(doc.ts).toLocaleDateString('ru-RU')}</span> • 
                        <span>📝 ${doc.text.length} символов</span>
                    </div>
                    <div class="doc-text">${doc.text.substring(0, 150)}${doc.text.length > 150 ? '...' : ''}</div>
                </div>
            `).join('');
            
            document.getElementById('documentsTable').innerHTML = docsHTML + 
                `<p style="margin-top: 16px; color: var(--md-outline); text-align: center;">Показано ${Math.min(10, docs.length)} из ${docs.length} документов</p>`;
        }

        function applyFilters() {
            const author = document.getElementById('filterAuthor').value;
            const title = document.getElementById('filterTitle').value;
            const minLength = parseInt(document.getElementById('filterMinLength').value) || 0;
            
            const filters = [];
            if (author) filters.push(byAuthor(author));
            if (title) filters.push(byTitle(title));
            if (minLength > 0) filters.push(byMinLength(minLength));
            
            const combinedFilter = composeFilters(...filters);
            const filtered = appData.documents.filter(combinedFilter);
            
            renderData(filtered);
        }

        // ============ PLAGIARISM CHECK ============
        function checkPlagiarism() {
            const text = document.getElementById('checkText').value;
            const n = parseInt(document.getElementById('ngramSize').value) || 3;
            const useCache = document.getElementById('useCache').value === 'true';
            
            if (!text || text.length < 10) {
                alert('Введите текст (минимум 10 символов)');
                return;
            }
            
            const normalized = normalize(text);
            const tokens = tokenize(normalized);
            const textNgrams = ngrams(tokens, n);
            
            const results = appData.documents.map(doc => {
                const similarity = useCache 
                    ? compareTextsCached(text, doc.text, n)
                    : jaccard(textNgrams, ngrams(tokenize(normalize(doc.text)), n));
                return { doc, similarity };
            }).sort((a, b) => b.similarity - a.similarity);
            
            const best = results[0];
            const percentage = Math.round(best.similarity * 100);
            
            let statusClass, statusText, statusIcon;
            if (percentage < 30) {
                statusClass = 'status-success';
                statusText = 'Оригинально';
                statusIcon = '✅';
            } else if (percentage < 70) {
                statusClass = 'status-warning';
                statusText = 'Подозрительно';
                statusIcon = '⚠️';
            } else {
                statusClass = 'status-error';
                statusText = 'Плагиат';
                statusIcon = '❌';
            }
            
            const top3HTML = results.slice(0, 3).map(r => `
                <div style="background: rgba(255,255,255,0.1); padding: 16px; border-radius: 12px; margin: 8px 0;">
                    <p style="font-weight: 600;">${r.doc.title}</p>
                    <p style="font-size: 14px; margin-bottom: 8px;">Автор: ${r.doc.author}</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.round(r.similarity * 100)}%; background: white;"></div>
                    </div>
                    <p style="text-align: right; font-weight: 600; margin-top: 4px;">${Math.round(r.similarity * 100)}%</p>
                </div>
            `).join('');
            
            document.getElementById('checkResult').innerHTML = `
                <div class="result-card">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div class="status-indicator ${statusClass}" style="display: inline-flex; font-size: 18px;">
                            <span>${statusIcon}</span>
                            <span>${statusText}</span>
                        </div>
                    </div>
                    
                    <div style="text-align: center;">
                        <div class="similarity-circle">${percentage}%</div>
                        <p style="font-size: 18px; font-weight: 600;">Максимальная похожесть</p>
                    </div>
                    
                    <h4 style="margin: 24px 0 12px;">📊 Топ-3 похожих документа:</h4>
                    ${top3HTML}
                    
                    <div style="margin-top: 24px; padding: 16px; background: rgba(255,255,255,0.1); border-radius: 12px;">
                        <p><strong>📈 Статистика обработки:</strong></p>
                        <p>• Токенов: ${tokens.length}</p>
                        <p>• ${n}-грамм: ${textNgrams.length}</p>
                        <p>• Проверено документов: ${appData.documents.length}</p>
                        <p>• Кэш: ${useCache ? 'включен ✅' : 'выключен ❌'}</p>
                    </div>
                </div>
            `;
        }

        // ============ FUNCTIONS DEMO ============
        function demonstrateFunctions() {
            const text = document.getElementById('demoText').value;
            
            if (!text) {
                alert('Введите текст для демонстрации');
                return;
            }
            
            const normalized = normalize(text);
            const tokens = tokenize(normalized);
            const bigrams = ngrams(tokens, 2);
            const trigrams = ngrams(tokens, 3);
            
            // Демонстрация map/filter/reduce
            const tokenLengths = tokens.map(t => t.length);
            const longTokens = tokens.filter(t => t.length > 3);
            const totalChars = tokenLengths.reduce((sum, len) => sum + len, 0);
            
            document.getElementById('functionResults').innerHTML = `
                <div class="card" style="margin-top: 24px;">
                    <h3 class="card-title">
                        <span class="material-icons">code</span>
                        Результаты обработки
                    </h3>
                    
                    <div class="info-box" style="background: #E3F2FD; border-left-color: #2196F3;">
                        <p style="font-weight: 600; margin-bottom: 8px;">1️⃣ normalize(text)</p>
                        <div class="code-block">"${normalized}"</div>
                    </div>
                    
                    <div class="info-box" style="background: #F3E5F5; border-left-color: #9C27B0;">
                        <p style="font-weight: 600; margin-bottom: 8px;">2️⃣ tokenize(text)</p>
                        <div class="code-block">[${tokens.map(t => `"${t}"`).join(', ')}]</div>
                        <p style="margin-top: 8px; color: var(--md-outline);">Всего токенов: ${tokens.length}</p>
                    </div>
                    
                    <div class="info-box" style="background: #E8F5E9; border-left-color: #4CAF50;">
                        <p style="font-weight: 600; margin-bottom: 8px;">3️⃣ ngrams(tokens, 2) - биграммы</p>
                        <div class="code-block">${bigrams.slice(0, 5).map(g => `"${g}"`).join(', ')}...</div>
                        <p style="margin-top: 8px; color: var(--md-outline);">Всего биграмм: ${bigrams.length}</p>
                    </div>
                    
                    <div class="info-box" style="background: #FFF3E0; border-left-color: #FF9800;">
                        <p style="font-weight: 600; margin-bottom: 8px;">4️⃣ ngrams(tokens, 3) - триграммы</p>
                        <div class="code-block">${trigrams.slice(0, 5).map(g => `"${g}"`).join(', ')}...</div>
                        <p style="margin-top: 8px; color: var(--md-outline);">Всего триграмм: ${trigrams.length}</p>
                    </div>
                    
                    <div class="info-box">
                        <p style="font-weight: 600; margin-bottom: 12px;">🔧 Демонстрация HOF (map/filter/reduce):</p>
                        <p><strong>map:</strong> длины токенов → [${tokenLengths.join(', ')}]</p>
                        <p><strong>filter:</strong> токены >3 символов → [${longTokens.map(t => `"${t}"`).join(', ')}]</p>
                        <p><strong>reduce:</strong> сумма длин → ${totalChars}</p>
                    </div>
                    
                    <div style="background: var(--md-primary-container); padding: 16px; border-radius: 12px; margin-top: 16px;">
                        <p style="font-weight: 600; color: var(--md-primary); text-align: center;">
                            ✅ Все функции работают корректно!
                        </p>
                    </div>
                </div>
            `;
        }

        // ============ COMPOSITION DEMO ============
        function demonstrateComposition() {
            const text = document.getElementById('pipelineText').value;
            
            if (!text) {
                alert('Введите текст для обработки');
                return;
            }
            
            // Пайплайн: normalize → tokenize → ngrams
            const step1 = normalize(text);
            const step2 = tokenize(step1);
            const step3 = ngrams(step2, 3);
            
            document.getElementById('compositionResult').innerHTML = `
                <div class="card" style="margin-top: 24px;">
                    <h3>Пайплайн обработки текста</h3>
                    
                    <div style="display: flex; align-items: center; gap: 12px; margin: 20px 0;">
                        <div class="info-box" style="flex: 1; margin: 0;">
                            <strong>Исходный текст</strong>
                            <p style="margin-top: 8px;">"${text}"</p>
                        </div>
                        <span class="material-icons" style="color: var(--md-primary);">arrow_forward</span>
                        <div class="info-box" style="flex: 1; margin: 0; background: #E3F2FD;">
                            <strong>normalize()</strong>
                            <p style="margin-top: 8px;">"${step1}"</p>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 12px; margin: 20px 0;">
                        <div class="info-box" style="flex: 1; margin: 0; background: #F3E5F5;">
                            <strong>tokenize()</strong>
                            <p style="margin-top: 8px;">[${step2.slice(0, 5).join(', ')}...]</p>
                            <p style="color: var(--md-outline); font-size: 12px; margin-top: 4px;">Всего: ${step2.length}</p>
                        </div>
                        <span class="material-icons" style="color: var(--md-primary);">arrow_forward</span>
                        <div class="info-box" style="flex: 1; margin: 0; background: #E8F5E9;">
                            <strong>ngrams(3)</strong>
                            <p style="margin-top: 8px;">${step3.length} триграмм</p>
                        </div>
                    </div>
                    
                    <div class="info-box">
                        <strong>✅ Композиция функций завершена</strong>
                        <p style="margin-top: 8px;">Функции вызываются последовательно, результат каждой передается в следующую.</p>
                    </div>
                </div>
            `;
        }

        // ============ MAYBE DEMO ============
        function demonstrateMaybe() {
            const docId = document.getElementById('docId').value;
            
            if (!docId) {
                alert('Введите ID документа');
                return;
            }
            
            const result = safeGetDocument(appData.documents, docId);
            
            if (result.isJust()) {
                const doc = result.get();
                document.getElementById('maybeResult').innerHTML = `
                    <div class="card" style="margin-top: 24px;">
                        <div class="info-box" style="background: #E8F5E9; border-left-color: var(--md-success);">
                            <h3>✅ Maybe.just(document)</h3>
                            <p style="margin-top: 12px;"><strong>Документ найден:</strong></p>
                            <div class="doc-item" style="margin-top: 12px;">
                                <div class="doc-title">${doc.title}</div>
                                <div class="doc-meta">
                                    <span>ID: ${doc.id}</span> • 
                                    <span>Автор: ${doc.author}</span>
                                </div>
                                <div class="doc-text">${doc.text.substring(0, 200)}...</div>
                            </div>
                        </div>
                        
                        <div class="code-block" style="margin-top: 16px;">
const result = safeGetDocument(documents, "${docId}");
// result.isJust() === true
// result.get() === Document {...}
                        </div>
                    </div>
                `;
            } else {
                document.getElementById('maybeResult').innerHTML = `
                    <div class="card" style="margin-top: 24px;">
                        <div class="info-box" style="background: #FFF3E0; border-left-color: var(--md-warning);">
                            <h3>⚠️ Maybe.nothing()</h3>
                            <p style="margin-top: 12px;">Документ с ID "${docId}" не найден в базе.</p>
                            <p style="margin-top: 8px; font-size: 14px; color: var(--md-outline);">
                                Maybe типы позволяют безопасно обрабатывать отсутствующие значения без исключений.
                            </p>
                        </div>
                        
                        <div class="code-block" style="margin-top: 16px;">
const result = safeGetDocument(documents, "${docId}");
// result.isNothing() === true
// result.get(defaultValue) === defaultValue
                        </div>
                    </div>
                `;
            }
        }

        // ============ VALIDATION DEMO ============
        function demonstrateValidation() {
            const text = document.getElementById('validationText').value;
            const minLength = parseInt(document.getElementById('minLengthValidation').value) || 50;
            
            const result = validateSubmission(text, minLength);
            
            if (result.isRight()) {
                const validText = result.getRight();
                document.getElementById('validationResult').innerHTML = `
                    <div class="card" style="margin-top: 24px;">
                        <div class="info-box" style="background: #E8F5E9; border-left-color: var(--md-success);">
                            <h3>✅ Either.right(text)</h3>
                            <p style="margin-top: 12px;"><strong>Валидация пройдена успешно!</strong></p>
                            <p style="margin-top: 8px;">Длина текста: ${validText.length} символов (минимум: ${minLength})</p>
                            <p style="margin-top: 8px; padding: 12px; background: white; border-radius: 8px;">
                                ${validText.substring(0, 100)}${validText.length > 100 ? '...' : ''}
                            </p>
                        </div>
                        
                        <div class="code-block" style="margin-top: 16px;">
const result = validateSubmission(text, ${minLength});
// result.isRight() === true
// Текст готов к проверке на плагиат
                        </div>
                    </div>
                `;
            } else {
                const error = result.getLeft();
                document.getElementById('validationResult').innerHTML = `
                    <div class="card" style="margin-top: 24px;">
                        <div class="info-box" style="background: #FFEBEE; border-left-color: var(--md-error);">
                            <h3>❌ Either.left(error)</h3>
                            <p style="margin-top: 12px;"><strong>Ошибка валидации:</strong></p>
                            <p style="margin-top: 8px; color: var(--md-error); font-weight: 500;">${error}</p>
                            <p style="margin-top: 12px; font-size: 14px; color: var(--md-outline);">
                                Either типы позволяют явно обрабатывать ошибки без throw/catch.
                            </p>
                        </div>
                        
                        <div class="code-block" style="margin-top: 16px;">
const result = validateSubmission(text, ${minLength});
// result.isLeft() === true
// result.getLeft() === "${error}"
                        </div>
                    </div>
                `;
            }
        }

        // ============ BENCHMARK (ЛАБА №3) ============
        async function runBenchmark() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<div class="loading"></div> Выполняется...';
            
            // Очищаем кэш
            cache.clear();
            cacheStats = { hits: 0, misses: 0 };
            updateCacheStats();
            
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Тест БЕЗ кэша
            const startNoCache = performance.now();
            const sampleSubs = appData.submissions.slice(0, 20);
            
            for (const sub of sampleSubs) {
                for (const doc of appData.documents.slice(0, 10)) {
                    const n1 = normalize(sub.text);
                    const n2 = normalize(doc.text);
                    const t1 = tokenize(n1);
                    const t2 = tokenize(n2);
                    const g1 = ngrams(t1, 3);
                    const g2 = ngrams(t2, 3);
                    jaccard(g1, g2);
                }
            }
            
            const timeNoCache = performance.now() - startNoCache;
            
            // Очищаем кэш для честного теста
            cache.clear();
            cacheStats = { hits: 0, misses: 0 };
            
            // Тест С кэшем (первый проход)
            const startCache1 = performance.now();
            for (const sub of sampleSubs) {
                for (const doc of appData.documents.slice(0, 10)) {
                    compareTextsCached(sub.text, doc.text, 3);
                }
            }
            const timeCache1 = performance.now() - startCache1;
            
            // Тест С кэшем (второй проход - должен быть быстрее)
            const startCache2 = performance.now();
            for (const sub of sampleSubs) {
                for (const doc of appData.documents.slice(0, 10)) {
                    compareTextsCached(sub.text, doc.text, 3);
                }
            }
            const timeCache2 = performance.now() - startCache2;
            
            const speedup1 = (timeNoCache / timeCache1).toFixed(2);
            const speedup2 = (timeNoCache / timeCache2).toFixed(2);
            
            btn.disabled = false;
            btn.innerHTML = '<span class="material-icons">speed</span> Запустить бенчмарк';
            
            document.getElementById('benchmarkResult').innerHTML = `
                <div class="card" style="margin-top: 24px;">
                    <h3 class="card-title">
                        <span class="material-icons">analytics</span>
                        Результаты бенчмарка
                    </h3>
                    
                    <p style="margin-bottom: 20px; color: var(--md-outline);">
                        Проверено: ${sampleSubs.length} проверок × ${appData.documents.slice(0, 10).length} документов = ${sampleSubs.length * 10} сравнений
                    </p>
                    
                    <div class="stats-grid">
                        <div class="stat-item" style="background: #FFEBEE;">
                            <div class="stat-value" style="color: var(--md-error);">${timeNoCache.toFixed(0)}мс</div>
                            <div class="stat-label">Без кэша</div>
                        </div>
                        <div class="stat-item" style="background: #FFF3E0;">
                            <div class="stat-value" style="color: var(--md-warning);">${timeCache1.toFixed(0)}мс</div>
                            <div class="stat-label">С кэшем (1 проход)</div>
                        </div>
                        <div class="stat-item" style="background: #E8F5E9;">
                            <div class="stat-value" style="color: var(--md-success);">${timeCache2.toFixed(0)}мс</div>
                            <div class="stat-label">С кэшем (2 проход)</div>
                        </div>
                    </div>
                    
                    <div class="info-box" style="margin-top: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                        <h4 style="margin-bottom: 12px; font-size: 18px;">🚀 Ускорение:</h4>
                        <p style="font-size: 16px;">• Первый проход: в <strong>${speedup1}x</strong> раз быстрее</p>
                        <p style="font-size: 16px;">• Второй проход: в <strong>${speedup2}x</strong> раз быстрее</p>
                        <p style="margin-top: 12px; font-size: 14px; opacity: 0.9;">
                            Мемоизация значительно ускоряет повторные вычисления!
                        </p>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="benchmarkChart" width="400" height="200"></canvas>
                    </div>
                </div>
            `;
            
            // Рисуем простую диаграмму
            drawBenchmarkChart(timeNoCache, timeCache1, timeCache2);
        }

        function drawBenchmarkChart(t1, t2, t3) {
            const canvas = document.getElementById('benchmarkChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const maxTime = Math.max(t1, t2, t3);
            const padding = 40;
            const barWidth = 80;
            const gap = 40;
            const maxHeight = canvas.height - 2 * padding;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Рисуем столбцы
            const bars = [
                { x: padding, height: (t1 / maxTime) * maxHeight, color: '#BA1A1A', label: 'Без кэша', time: t1 },
                { x: padding + barWidth + gap, height: (t2 / maxTime) * maxHeight, color: '#F57C00', label: 'С кэшем (1)', time: t2 },
                { x: padding + 2 * (barWidth + gap), height: (t3 / maxTime) * maxHeight, color: '#2E7D32', label: 'С кэшем (2)', time: t3 }
            ];
            
            bars.forEach(bar => {
                const y = canvas.height - padding - bar.height;
                
                // Столбец
                ctx.fillStyle = bar.color;
                ctx.fillRect(bar.x, y, barWidth, bar.height);
                
                // Значение
                ctx.fillStyle = '#1C1B1F';
                ctx.font = 'bold 14px Roboto';
                ctx.textAlign = 'center';
                ctx.fillText(`${bar.time.toFixed(0)}мс`, bar.x + barWidth / 2, y - 10);
                
                // Подпись
                ctx.font = '12px Roboto';
                ctx.fillText(bar.label, bar.x + barWidth / 2, canvas.height - padding + 20);
            });
        }

        // ============ REPORTS ============
        function generateReport() {
            generateSummaryReport();
            generateTopReport();
            generateUsersReport();
        }

        function generateSummaryReport() {
            // Используем функции из всех лабораторных работ
            
            // ЛАБА №1: Чистые функции + HOF (map/filter/reduce)
            const results = appData.submissions.map(sub => {
                // normalize, tokenize, ngrams, jaccard
                const similarities = appData.documents.map(doc => 
                    compareTextsCached(sub.text, doc.text, 3)
                );
                const maxSim = Math.max(...similarities);
                return { sub, maxSim };
            });
            
            // ЛАБА №2: Замыкания для фильтрации
            const byThreshold = (threshold) => (r) => r.maxSim >= threshold;
            
            const original = results.filter(r => r.maxSim < 0.3).length;
            const suspicious = results.filter(byThreshold(0.3)).filter(r => r.maxSim < 0.7).length;
            const plagiarism = results.filter(byThreshold(0.7)).length;
            
            // ЛАБА №1: reduce для подсчета
            const totalSimilarity = results.reduce((sum, r) => sum + r.maxSim, 0);
            const avgSimilarity = results.length > 0 ? (totalSimilarity / results.length) : 0;
            
            document.getElementById('summaryContent').innerHTML = `
                <div class="info-box" style="margin-bottom: 20px;">
                    <h4>📊 Использованные техники функционального программирования:</h4>
                    <p>✅ <strong>Лаба №1:</strong> map() для обработки, filter() для фильтрации, reduce() для агрегации</p>
                    <p>✅ <strong>Лаба №2:</strong> Замыкания byThreshold() для создания фильтров</p>
                    <p>✅ <strong>Лаба №3:</strong> Мемоизация через compareTextsCached()</p>
                    <p>✅ <strong>Средняя схожесть:</strong> ${(avgSimilarity * 100).toFixed(1)}%</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-item" style="background: #E8F5E9;">
                        <div class="stat-value" style="color: var(--md-success);">${original}</div>
                        <div class="stat-label">✅ Оригинальные (<30%)</div>
                    </div>
                    <div class="stat-item" style="background: #FFF3E0;">
                        <div class="stat-value" style="color: var(--md-warning);">${suspicious}</div>
                        <div class="stat-label">⚠️ Подозрительные (30-70%)</div>
                    </div>
                    <div class="stat-item" style="background: #FFEBEE;">
                        <div class="stat-value" style="color: var(--md-error);">${plagiarism}</div>
                        <div class="stat-label">❌ Плагиат (>70%)</div>
                    </div>
                </div>
                
                <div class="chart-container" style="margin-top: 20px;">
                    <canvas id="summaryChart" width="400" height="200"></canvas>
                </div>
                
                <div class="code-block" style="margin-top: 20px;">
// Пример использования HOF и замыканий:
const byThreshold = (threshold) => (result) => result.maxSim >= threshold;

const original = results.filter(r => r.maxSim < 0.3);
const suspicious = results.filter(byThreshold(0.3)).filter(r => r.maxSim < 0.7);
const plagiarism = results.filter(byThreshold(0.7));

const avgSimilarity = results.reduce((sum, r) => sum + r.maxSim, 0) / results.length;
                </div>
            `;
            
            setTimeout(() => drawPieChart(original, suspicious, plagiarism), 100);
        }

        function drawPieChart(original, suspicious, plagiarism) {
            const canvas = document.getElementById('summaryChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 80;
            
            const total = original + suspicious + plagiarism;
            if (total === 0) {
                ctx.font = '16px Roboto';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('Нет данных для отображения', centerX, centerY);
                return;
            }
            
            const colors = ['#2E7D32', '#F57C00', '#BA1A1A'];
            const values = [original, suspicious, plagiarism];
            const labels = ['Оригинальные', 'Подозрительные', 'Плагиат'];
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            let currentAngle = -Math.PI / 2;
            
            values.forEach((value, i) => {
                if (value === 0) return;
                
                const sliceAngle = (value / total) * 2 * Math.PI;
                
                // Рисуем сектор
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fillStyle = colors[i];
                ctx.fill();
                
                // Добавляем обводку
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Рисуем процент в секторе
                const labelAngle = currentAngle + sliceAngle / 2;
                const labelX = centerX + Math.cos(labelAngle) * (radius * 0.6);
                const labelY = centerY + Math.sin(labelAngle) * (radius * 0.6);
                
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 14px Roboto';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                const percentage = Math.round((value / total) * 100);
                ctx.fillText(`${percentage}%`, labelX, labelY);
                
                currentAngle += sliceAngle;
            });
            
            // Рисуем легенду справа
            const legendX = canvas.width - 150;
            let legendY = 20;
            
            values.forEach((value, i) => {
                if (value === 0) return;
                
                // Квадратик цвета
                ctx.fillStyle = colors[i];
                ctx.fillRect(legendX, legendY, 20, 20);
                
                // Текст
                ctx.fillStyle = '#1C1B1F';
                ctx.font = '14px Roboto';
                ctx.textAlign = 'left';
                ctx.textBaseline = 'top';
                ctx.fillText(`${labels[i]}: ${value}`, legendX + 28, legendY + 3);
                
                legendY += 30;
            });
        }

        function generateTopReport() {
            // ЛАБА №1: map для трансформации данных
            const results = appData.submissions.map(sub => {
                // ЛАБА №1: normalize, tokenize, ngrams, jaccard
                const similarities = appData.documents.map(doc => ({
                    doc,
                    sim: compareTextsCached(sub.text, doc.text, 3)
                }));
                
                // ЛАБА №1: reduce для нахождения максимума
                const best = similarities.reduce((max, current) => 
                    current.sim > max.sim ? current : max
                , similarities[0]);
                
                return { sub, ...best };
            }).sort((a, b) => b.sim - a.sim).slice(0, 10);
            
            // ЛАБА №2: Замыкание для создания классификатора
            const getStatusClass = (percentage) => {
                if (percentage < 30) return 'status-success';
                if (percentage < 70) return 'status-warning';
                return 'status-error';
            };
            
            const html = results.map((r, i) => {
                const percentage = Math.round(r.sim * 100);
                const statusClass = getStatusClass(percentage);
                
                return `
                    <div class="doc-item">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="font-weight: 600;">${i + 1}. Проверка ${r.sub.id}</span>
                            <span class="status-indicator ${statusClass}">${percentage}%</span>
                        </div>
                        <div class="doc-meta">
                            👤 Пользователь: ${r.sub.user_id} • 
                            📄 Похож на: "${r.doc.title}" (${r.doc.author})
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%"></div>
                        </div>
                        <div class="doc-text">${r.sub.text.substring(0, 120)}...</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('topContent').innerHTML = `
                <div class="info-box" style="margin-bottom: 20px; background: #E3F2FD; border-left-color: #2196F3;">
                    <h4>🔧 Применённые техники:</h4>
                    <p>• <strong>map():</strong> Трансформация submissions в результаты</p>
                    <p>• <strong>reduce():</strong> Поиск документа с максимальной схожестью</p>
                    <p>• <strong>sort():</strong> Сортировка по убыванию схожести</p>
                    <p>• <strong>Замыкание getStatusClass():</strong> Классификация по порогам</p>
                </div>
                
                <h3 style="margin-bottom: 16px;">📉 Топ-10 проблемных проверок</h3>
                ${html}
                
                <div class="code-block" style="margin-top: 20px;">
// Композиция функций для обработки:
const results = submissions
    .map(sub => ({ sub, best: findBestMatch(sub, documents) }))
    .sort((a, b) => b.best.sim - a.best.sim)
    .slice(0, 10);

const getStatusClass = (percentage) => 
    percentage < 30 ? 'success' : percentage < 70 ? 'warning' : 'error';
                </div>
            `;
        }

        function generateUsersReport() {
            // ЛАБА №2: Замыкание для группировки по пользователям
            const groupByUser = (userId) => (sub) => sub.user_id === userId;
            
            // ЛАБА №1: map + filter + reduce
            const userStats = appData.users.map(user => {
                // Фильтруем проверки пользователя
                const userSubs = appData.submissions.filter(groupByUser(user.id));
                
                if (userSubs.length === 0) {
                    return { user, count: 0, avgSim: 0, maxSim: 0 };
                }
                
                // Вычисляем схожести для каждой проверки
                const similarities = userSubs.map(sub => {
                    const docSims = appData.documents.map(doc => 
                        compareTextsCached(sub.text, doc.text, 3)
                    );
                    return Math.max(...docSims);
                });
                
                // ЛАБА №1: reduce для вычисления средней и максимальной
                const avgSim = similarities.reduce((sum, sim) => sum + sim, 0) / similarities.length;
                const maxSim = Math.max(...similarities);
                
                return { user, count: userSubs.length, avgSim, maxSim };
            })
            .filter(s => s.count > 0)  // Только активные пользователи
            .sort((a, b) => b.avgSim - a.avgSim);
            
            // ЛАБА №2: Замыкание для классификации
            const classifyUser = (avgSimilarity) => {
                const percentage = avgSimilarity * 100;
                if (percentage < 30) return { class: 'status-success', icon: '✅', label: 'Отлично' };
                if (percentage < 50) return { class: 'status-warning', icon: '⚠️', label: 'Нормально' };
                return { class: 'status-error', icon: '❌', label: 'Проблемы' };
            };
            
            const html = userStats.map((stat, i) => {
                const avgPercentage = Math.round(stat.avgSim * 100);
                const maxPercentage = Math.round(stat.maxSim * 100);
                const classification = classifyUser(stat.avgSim);
                
                return `
                    <div class="doc-item">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div class="doc-title">${i + 1}. ${stat.user.name}</div>
                                <div class="doc-meta">
                                    📊 Проверок: ${stat.count} • 
                                    📈 Средняя: ${avgPercentage}% • 
                                    🔝 Максимум: ${maxPercentage}%
                                </div>
                            </div>
                            <span class="status-indicator ${classification.class}">
                                ${classification.icon} ${classification.label}
                            </span>
                        </div>
                        <div class="progress-bar" style="margin-top: 12px;">
                            <div class="progress-fill" style="width: ${avgPercentage}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // ЛАБА №1: reduce для общей статистики
            const totalChecks = userStats.reduce((sum, s) => sum + s.count, 0);
            const avgOfAvgs = userStats.length > 0 
                ? userStats.reduce((sum, s) => sum + s.avgSim, 0) / userStats.length 
                : 0;
            
            document.getElementById('usersContent').innerHTML = `
                <div class="info-box" style="margin-bottom: 20px; background: #F3E5F5; border-left-color: #9C27B0;">
                    <h4>🎯 Функциональные техники в действии:</h4>
                    <p>• <strong>Замыкание groupByUser():</strong> Фильтрация по пользователю</p>
                    <p>• <strong>map():</strong> Трансформация пользователей в статистику</p>
                    <p>• <strong>filter():</strong> Отсеивание неактивных пользователей</p>
                    <p>• <strong>reduce():</strong> Агрегация метрик (сумма, среднее)</p>
                    <p>• <strong>Замыкание classifyUser():</strong> Классификация по порогам</p>
                </div>
                
                <div class="stats-grid" style="margin-bottom: 20px;">
                    <div class="stat-item">
                        <div class="stat-value">${userStats.length}</div>
                        <div class="stat-label">Активных пользователей</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${totalChecks}</div>
                        <div class="stat-label">Всего проверок</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${Math.round(avgOfAvgs * 100)}%</div>
                        <div class="stat-label">Средняя схожесть</div>
                    </div>
                </div>
                
                <h3 style="margin-bottom: 16px;">👥 Рейтинг пользователей</h3>
                ${html}
                
                <div class="code-block" style="margin-top: 20px;">
// Композиция HOF для анализа пользователей:
const groupByUser = (userId) => (sub) => sub.user_id === userId;

const userStats = users
    .map(user => ({
        user,
        subs: submissions.filter(groupByUser(user.id)),
        avgSim: calculateAverage(user),
        maxSim: calculateMax(user)
    }))
    .filter(stat => stat.subs.length > 0)
    .sort((a, b) => b.avgSim - a.avgSim);

const classifyUser = (avg) => 
    avg < 0.3 ? 'excellent' : avg < 0.5 ? 'good' : 'needs-attention';
                </div>
            `;
        }

        // ============ TESTS ============
        function runAllTests() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<div class="loading"></div> Выполняются тесты...';
            
            setTimeout(() => {
                const tests = [
                    testNormalize(),
                    testTokenize(),
                    testNgrams(),
                    testJaccard(),
                    testFilters(),
                    testMaybe(),
                    testEither(),
                    testCache()
                ];
                
                const passed = tests.filter(t => t.passed).length;
                const total = tests.length;
                
                const html = tests.map(test => `
                    <div class="doc-item" style="border-left-color: ${test.passed ? 'var(--md-success)' : 'var(--md-error)'}">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span class="doc-title">${test.name}</span>
                            <span class="status-indicator ${test.passed ? 'status-success' : 'status-error'}">
                                ${test.passed ? '✅ Пройден' : '❌ Провален'}
                            </span>
                        </div>
                        <p style="margin-top: 8px; color: var(--md-outline);">${test.description}</p>
                        ${test.error ? `<p style="margin-top: 8px; color: var(--md-error);">Ошибка: ${test.error}</p>` : ''}
                    </div>
                `).join('');
                
                btn.disabled = false;
                btn.innerHTML = '<span class="material-icons">play_circle</span> Запустить все тесты';
                
                document.getElementById('testResults').innerHTML = `
                    <div class="card" style="margin-top: 24px;">
                        <div class="info-box" style="background: ${passed === total ? '#E8F5E9' : '#FFF3E0'}; border-left-color: ${passed === total ? 'var(--md-success)' : 'var(--md-warning)'};">
                            <h3>${passed === total ? '✅' : '⚠️'} Результаты тестирования</h3>
                            <p style="font-size: 18px; margin-top: 12px;">
                                Пройдено: <strong>${passed} из ${total}</strong> тестов
                            </p>
                        </div>
                        
                        ${html}
                    </div>
                `;
            }, 500);
        }

        function testNormalize() {
            try {
                const result = normalize("Hello, World!  ");
                return {
                    name: "test_normalize",
                    description: "Проверка нормализации текста",
                    passed: result === "hello world",
                    error: null
                };
            } catch (e) {
                return { name: "test_normalize", description: "Проверка нормализации текста", passed: false, error: e.message };
            }
        }

        function testTokenize() {
            try {
                const result = tokenize("a   b c");
                return {
                    name: "test_tokenize",
                    description: "Проверка токенизации текста",
                    passed: result.length === 3 && result[0] === "a",
                    error: null
                };
            } catch (e) {
                return { name: "test_tokenize", description: "Проверка токенизации текста", passed: false, error: e.message };
            }
        }

        function testNgrams() {
            try {
                const tokens = ["a", "b", "c", "d"];
                const result = ngrams(tokens, 3);
                return {
                    name: "test_ngrams",
                    description: "Проверка создания n-грамм",
                    passed: result.length === 2 && result[0] === "a b c",
                    error: null
                };
            } catch (e) {
                return { name: "test_ngrams", description: "Проверка создания n-грамм", passed: false, error: e.message };
            }
        }

        function testJaccard() {
            try {
                const a = ["a", "b", "c"];
                const b = ["b", "c", "d"];
                const result = jaccard(a, b);
                return {
                    name: "test_jaccard",
                    description: "Проверка коэффициента Жаккара",
                    passed: result > 0 && result < 1,
                    error: null
                };
            } catch (e) {
                return { name: "test_jaccard", description: "Проверка коэффициента Жаккара", passed: false, error: e.message };
            }
        }

        function testFilters() {
            try {
                const docs = appData.documents.slice(0, 5);
                const filter = byMinLength(100);
                const result = docs.filter(filter);
                return {
                    name: "test_filters",
                    description: "Проверка замыканий-фильтров",
                    passed: result.length >= 0,
                    error: null
                };
            } catch (e) {
                return { name: "test_filters", description: "Проверка замыканий-фильтров", passed: false, error: e.message };
            }
        }

        function testMaybe() {
            try {
                const just = Maybe.just(5);
                const nothing = Maybe.nothing();
                return {
                    name: "test_maybe",
                    description: "Проверка Maybe типа",
                    passed: just.isJust() && nothing.isNothing() && just.get() === 5,
                    error: null
                };
            } catch (e) {
                return { name: "test_maybe", description: "Проверка Maybe типа", passed: false, error: e.message };
            }
        }

        function testEither() {
            try {
                const right = Either.right(5);
                const left = Either.left("error");
                return {
                    name: "test_either",
                    description: "Проверка Either типа",
                    passed: right.isRight() && left.isLeft() && right.getRight() === 5,
                    error: null
                };
            } catch (e) {
                return { name: "test_either", description: "Проверка Either типа", passed: false, error: e.message };
            }
        }

        function testCache() {
            try {
                cache.clear();
                const text1 = "test text one";
                const text2 = "test text two";
                
                compareTextsCached(text1, text2, 3); // miss
                compareTextsCached(text1, text2, 3); // hit
                
                return {
                    name: "test_cache",
                    description: "Проверка мемоизации",
                    passed: cacheStats.hits > 0 && cache.size > 0,
                    error: null
                };
            } catch (e) {
                return { name: "test_cache", description: "Проверка мемоизации", passed: false, error: e.message };
            }
        }

        // ============ INITIALIZATION ============
        window.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>